# WebRTC 信令服务器

这是一个简单的WebRTC信令服务器，用于在发送端和接收端之间交换会话描述和ICE候选信息。

## 安装

1. 确保你已安装 [Node.js](https://nodejs.org/) (版本 14.0.0 或更高)
2. 在项目目录下运行以下命令安装依赖：

```bash
npm install
```

## 运行服务器

### 基本版本

```bash
npm start
```

或者直接运行：

```bash
node server.js
```

### 高级版本（支持多房间）

```bash
node server_advanced.js
```

服务器将在端口 6060 上启动。

## 使用方法

1. 启动信令服务器
2. 在Android发送端和接收端应用中，输入信令服务器地址（例如：`192.168.10.103:6060`）
3. 点击"开始投屏"或"开始接收"按钮

### 使用高级版本的房间功能

高级版本支持多房间功能，可以通过URL查询参数指定房间：

```
ws://服务器IP:6060?room=房间名称
```

例如：
- `ws://192.168.10.103:6060?room=room1`
- `ws://192.168.10.103:6060?room=office`

## 功能对比

| 功能 | 基本版本 (server.js) | 高级版本 (server_advanced.js) |
|------|---------------------|---------------------------|
| 消息转发 | ✅ | ✅ |
| 角色识别 | ✅ | ✅ |
| 多房间支持 | ❌ | ✅ |
| 客户端唯一ID | ❌ | ✅ |
| 状态监控 | ❌ | ✅ |
| 错误处理 | 基本 | 高级 |
| HTTP服务 | ❌ | ✅ |
| 心跳检测 | ❌ | ✅ |

## 工作原理

1. 服务器接收来自发送端和接收端的WebSocket连接
2. 服务器根据消息类型（offer/answer）识别客户端角色
3. 服务器将发送端的消息转发给接收端，将接收端的消息转发给发送端
4. 发送端和接收端通过交换的信息建立P2P连接

### 高级版本工作流程

1. 客户端连接到服务器，可以指定房间ID
2. 服务器为每个客户端分配唯一ID，并将其添加到指定房间
3. 客户端发送offer/answer消息时，服务器识别其角色（发送者/接收者）
4. 服务器只在同一房间内的发送者和接收者之间转发消息
5. 支持客户端切换房间、发送心跳检测等高级功能

## 注意事项

- 确保发送端和接收端设备在同一网络中
- 如果遇到连接问题，请检查防火墙设置，确保端口6060未被阻止
- 服务器IP地址应该是运行服务器的计算机的局域网IP地址
- 高级版本支持通过HTTP访问（http://服务器IP:6060）查看服务器状态

## 修改Android客户端以支持房间功能

如果想要在Android客户端中使用高级版本的房间功能，需要修改WebSocket连接URL：

```kotlin
// 原代码
val wsUrl = "ws://$serverAddress"

// 修改为（添加房间参数）
val roomId = "room1" // 可以由用户输入或其他方式指定
val wsUrl = "ws://$serverAddress?room=$roomId"
``` 