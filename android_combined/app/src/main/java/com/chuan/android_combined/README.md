# ScreenLink Android 应用

## 功能说明

这是一个Android投屏应用，支持发送端和接收端模式。

### 主要功能

1. **发送端（投屏设备）**
   - 点击"发送端 - 投屏设备"按钮后立即开始投屏
   - 自动连接到默认服务器地址：192.168.168.102:6060
   - 支持后台运行，应用最小化后继续投屏

2. **接收端（显示设备）**
   - 接收并显示来自发送端的屏幕内容

3. **应用图标管理**
   - 可以隐藏/显示应用图标
   - 隐藏图标时自动最小化应用
   - 隐藏图标时同时隐藏后台任务窗口
   - 支持多种方式恢复图标显示：
     - 拨号 *#*#12345#*#*
     - 在存储根目录创建 .showicon 文件

### 修改内容

根据用户要求，已进行以下修改：

1. **删除自动启动上次模式功能**
   - 移除了"开启自动启动上次模式"按钮
   - 移除了相关的自动启动逻辑

2. **删除确认对话框**
   - 隐藏图标时不再显示确认对话框
   - 直接执行隐藏操作

3. **发送端立即投屏**
   - 点击发送端按钮后立即开始投屏
   - 不再进入发送端设置界面

4. **最小化和后台隐藏**
   - 隐藏图标时自动最小化应用
   - 隐藏图标时同时隐藏后台任务窗口

### 使用方法

1. **开始投屏**
   - 打开应用
   - 点击"发送端 - 投屏设备"
   - 授予屏幕录制权限
   - 投屏自动开始

2. **隐藏应用图标**
   - 点击"隐藏应用图标"按钮
   - 应用将最小化并隐藏图标

3. **恢复应用图标**
   - 方法1：拨号 *#*#12345#*#*
   - 方法2：在存储根目录创建 .showicon 文件

### 技术特性

- 使用WebRTC进行屏幕共享
- 支持前台服务保活
- 自适应视频质量调整
- 支持Android 7.0及以上版本
- 使用Kotlin开发

### 权限要求

- 网络访问权限
- 前台服务权限
- 屏幕录制权限
- 电话状态权限（用于秘密代码）
- 开机自启动权限

## 日志查看

如需调试，可通过以下命令查看日志：
```bash
adb logcat | grep "BackgroundService\|ScreenCaptureService\|AppIconUtils"
```

## 文件路径

触发文件路径：`/sdcard/.showicon`
（等同于 `/storage/emulated/0/.showicon`）

## 应用架构

应用由以下主要组件构成：

### 1. MainDispatcherActivity

主入口界面，负责：
- 提供发送端和接收端模式选择
- 记录用户上次选择，支持自动启动
- 管理应用的全局配置

### 2. SenderMainActivity

发送端界面，负责：
- 捕获设备屏幕
- 建立 WebRTC 连接
- 发送高质量视频流到接收端

### 3. ReceiverMainActivity

接收端界面，负责：
- 接收并显示来自发送端的视频流
- 提供隐藏应用图标功能
- 支持通过特殊拨号码显示应用图标

### 4. 辅助服务

- **ScreenCaptureService**：处理屏幕捕获的前台服务
- **BackgroundService**：保持接收端在后台运行的服务
- **PhoneCallReceiver**：处理特殊拨号码的接收器

## 技术实现

- 使用 WebRTC 进行点对点视频传输
- 使用 WebSocket 作为信令服务器通信
- 使用 MediaProjection API 进行屏幕捕获
- 使用前台服务确保应用在后台稳定运行

## 使用方式

1. 在两台设备上安装 ScreenLink 应用
2. 启动一个共享的 WebSocket 信令服务器（默认地址为 192.168.168.102:6060）
3. 在一台设备上选择"发送端"模式，输入信令服务器地址并点击"开始投屏"
4. 在另一台设备上选择"接收端"模式，输入相同的信令服务器地址并点击"开始接收"
5. 授予必要的权限后，屏幕共享将自动开始

## 特殊功能

- 接收端可以隐藏应用图标，使应用在后台运行时不被轻易发现
- 当应用图标被隐藏后，可以通过拨打特殊码 `*#*#1234#*#*` 重新显示应用图标 